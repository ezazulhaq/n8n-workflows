{
    "name": "Improved Islamic Agent",
    "nodes": [
        {
            "parameters": {
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.3,
            "position": [
                -576,
                0
            ],
            "id": "chat-trigger",
            "name": "When chat message received"
        },
        {
            "parameters": {
                "sessionKey": "islamic_session",
                "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
                -200,
                200
            ],
            "id": "memory-buffer",
            "name": "Conversation Memory"
        },
        {
            "parameters": {
                "options": {
                    "systemMessage": "# Islamic Knowledge Assistant\n\nYou are a comprehensive Islamic knowledge assistant with access to authentic Islamic sources.\n\n## Available Tools\n1. **Quran Knowledge**: Search the complete Quran for verses and interpretations\n2. **Get Specific Ayah**: Retrieve exact verse by Surah and Ayah number\n3. **Sahih Bukhari**: Access authentic Hadith from Sahih Bukhari\n4. **Sahih Muslim**: Access authentic Hadith from Sahih Muslim  \n5. **Riyad Us Saliheen**: Practical Islamic guidance and teachings\n6. **Prophet Biography**: Comprehensive life story of Prophet Muhammad (pbuh)\n7. **Islamic History**: Historical events and Shia-Sunni context\n\n## Response Guidelines\n\n### Scope\n- **ONLY answer Islamic questions**: Quran, Hadith, Islamic history, jurisprudence, theology, practice\n- **For non-Islamic queries**: \"I apologize, but I specialize in Islamic knowledge only. Please ask about Islamic topics such as Quran, Hadith, Islamic history, or religious practices.\"\n\n### Greeting Behavior\n- **First interaction**: Respond naturally to the user's question without automatic greeting\n- **If user greets explicitly** (Assalamu Alaykum, Hello, Hi): Respond with \"Wa alaykumu assalam. I'm your Islamic knowledge assistant. How can I help with Islamic matters today?\"\n\n### Tool Usage Priority\n1. For Quranic questions → Use \"Quran Knowledge\" first\n2. For specific verse requests → Use \"Get Specific Ayah\" with exact Surah:Ayah\n3. For Hadith questions → Prioritize Sahih Bukhari, then Sahih Muslim\n4. For practical guidance → Use Riyad Us Saliheen\n5. For Prophet's life → Use Prophet Biography\n6. For historical context → Use Islamic History\n\n### Citation Standards\n- Always include source references (Quran: Surah X, Ayah Y)\n- For Hadith: Include collection name and reference number when available\n- Maintain scholarly Islamic tone with respect for Prophet Muhammad (pbuh)\n\n### Error Handling\n- If no relevant results from tools: \"I couldn't find specific information on this topic in my Islamic sources. Could you rephrase your question or ask about a related Islamic topic?\"\n- Always attempt to use tools before responding\n- Provide authentic, source-based responses only",
                    "maxIterations": 3,
                    "temperature": 0.2
                }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 2.2,
            "position": [
                -200,
                0
            ],
            "id": "main-islamic-agent",
            "name": "Islamic Knowledge Agent"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Search the complete Quran for verses, topics, and interpretations. Use this for general Quranic knowledge queries.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "quran",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "full_quran"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                100,
                100
            ],
            "id": "quran-knowledge",
            "name": "Quran Knowledge"
        },
        {
            "parameters": {
                "description": "Retrieve a specific Ayah from the Quran. Requires exact Surah ID (1-114) and Ayah number. Use only when user requests a specific verse reference.",
                "workflowId": {
                    "__rl": true,
                    "value": "owrGoln2UMtickrP",
                    "mode": "list"
                },
                "workflowInputs": {
                    "mappingMode": "defineBelow",
                    "value": {
                        "surah_id": "={{ $fromAI('surah_id', 'Surah number from 1 to 114', 'number') }}",
                        "ayah_number": "={{ $fromAI('ayah_number', 'Ayah/verse number within the specified Surah', 'number') }}"
                    }
                }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.2,
            "position": [
                100,
                200
            ],
            "id": "get-specific-ayah",
            "name": "Get Specific Ayah"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Access authentic Hadith from Sahih Bukhari collection. Primary source for prophetic traditions and Islamic teachings.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "hadith",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "sahih_bukhari"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                300,
                100
            ],
            "id": "sahih-bukhari",
            "name": "Sahih Bukhari Hadith"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Access authentic Hadith from Sahih Muslim collection. Secondary source for prophetic traditions.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "hadith",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "sahih_muslim"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                300,
                200
            ],
            "id": "sahih-muslim",
            "name": "Sahih Muslim Hadith"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Access Riyad Us Saliheen for practical Islamic guidance and spiritual teachings for daily life applications.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "hadith",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "riyad_us_saliheen"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                500,
                100
            ],
            "id": "riyad-us-saliheen",
            "name": "Riyad Us Saliheen"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Comprehensive biography of Prophet Muhammad (peace be upon him), covering his life story and early Islamic period.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "islam",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "life_of_prophet_muhammad"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                500,
                200
            ],
            "id": "prophet-biography",
            "name": "Prophet Muhammad Biography"
        },
        {
            "parameters": {
                "mode": "retrieve-as-tool",
                "toolDescription": "Historical information about Islamic events, including the Shia-Sunni split and early Islamic history.",
                "pineconeIndex": {
                    "__rl": true,
                    "value": "islam",
                    "mode": "list"
                },
                "topK": 5,
                "options": {
                    "pineconeNamespace": "shia_sunni"
                }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
            "typeVersion": 1.3,
            "position": [
                700,
                100
            ],
            "id": "islamic-history",
            "name": "Islamic History"
        },
        {
            "parameters": {
                "model": "llama-3.1-8b-instant",
                "options": {
                    "temperature": 0.2,
                    "maxTokens": 1000
                }
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
            "typeVersion": 1,
            "position": [
                -400,
                200
            ],
            "id": "llm-model",
            "name": "Llama 3.1 Model"
        },
        {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
            "typeVersion": 1,
            "position": [
                700,
                300
            ],
            "id": "embedding-model",
            "name": "Embedding Model"
        }
    ],
    "connections": {
        "When chat message received": {
            "main": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Conversation Memory": {
            "ai_memory": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_memory",
                        "index": 0
                    }
                ]
            ]
        },
        "Llama 3.1 Model": {
            "ai_languageModel": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "Quran Knowledge": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Get Specific Ayah": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Sahih Bukhari Hadith": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Sahih Muslim Hadith": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Riyad Us Saliheen": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Prophet Muhammad Biography": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Islamic History": {
            "ai_tool": [
                [
                    {
                        "node": "Islamic Knowledge Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        },
        "Embedding Model": {
            "ai_embedding": [
                [
                    {
                        "node": "Quran Knowledge",
                        "type": "ai_embedding",
                        "index": 0
                    },
                    {
                        "node": "Sahih Bukhari Hadith",
                        "type": "ai_embedding",
                        "index": 0
                    },
                    {
                        "node": "Sahih Muslim Hadith",
                        "type": "ai_embedding",
                        "index": 0
                    },
                    {
                        "node": "Riyad Us Saliheen",
                        "type": "ai_embedding",
                        "index": 0
                    },
                    {
                        "node": "Prophet Muhammad Biography",
                        "type": "ai_embedding",
                        "index": 0
                    },
                    {
                        "node": "Islamic History",
                        "type": "ai_embedding",
                        "index": 0
                    }
                ]
            ]
        }
    }
}